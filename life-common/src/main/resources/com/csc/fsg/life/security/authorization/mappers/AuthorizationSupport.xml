<?xml version="1.0" encoding="UTF-8"?>
<!-- Modifications: ENH1220, T0199 -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AuthorityCache">
	<resultMap id="EnvironmentCompanyCacheResult" type="EnvironmentCompanyModel">
		<result property="environment" column="ENVIRONMENT"/>
		<result property="companyCode" column="COMPANY_CODE"/>
	</resultMap>

	<resultMap id="AuthorityCacheResult" type="AuthorityCacheModel">
		<result property="id" column="ID"/>
		<result property="resourceType" column="RESOURCE_TYPE"/>
		<result property="environment" column="ENVIRONMENT"/>
		<result property="companyCode" column="COMPANY_CODE"/>
		<result property="useCaseId" column="USE_CASE_ID"/>
		<result property="fullBoName" column="FULL_BO_NAME"/>
		<result property="buttonName" column="BUTTON_NAME"/>
		<result property="maskClass" column="MASK_CLASS"/>
		<result property="tableId" column="TABLE_ID"/>
		<result property="className" column="CLASS_NAME"/>
		<result property="methodSignature" column="METHOD_SIGNATURE"/>
		<result property="specialOperationType" column="SPECIAL_OPERATION_TYPE"/>
	</resultMap>

	<select id="selectSecureEnvironmentCompanyListForApplication" resultMap="EnvironmentCompanyCacheResult" parameterType="string">
		SELECT DISTINCT RTRIM(COMPANY.ENVIRONMENT) AS ENVIRONMENT,
		                RTRIM(COMPANY.COMPANY_CODE) AS COMPANY_CODE
		  FROM USAPPL USAPPL,
		       ENVIRONMNT ENVIRONMNT,
		       COMPANY COMPANY
		 WHERE USAPPL.APPL_KEY = ENVIRONMNT.APPL_KEY
		   AND USAPPL.APPL_KEY = COMPANY.APPL_KEY
		   AND ENVIRONMNT.ENVIRONMENT = COMPANY.ENVIRONMENT
		   AND ENVIRONMNT.STATUS_IND = 'A'
		   AND COMPANY.STATUS_IND = 'A'
		   AND USAPPL.APPL_ID = #{value}
	</select>

	<select id="selectActiveRoleIdsForApplication" parameterType="string" resultType="string">
		SELECT RTRIM(ROLE.ROLE_NAME) AS ROLE_NAME
		  FROM USAPPL USAPPL,
		       ROLE ROLE
		 WHERE USAPPL.APPL_KEY = ROLE.APPL_KEY
		   AND ROLE.STATUS_IND = 'A'
		   AND USAPPL.APPL_ID = #{value}
	</select>

	<select id="selectAuthorityListForApplication" resultMap="AuthorityCacheResult" parameterType="string">
		/* Use Cases (sometimes referred to as pages) */
		SELECT AUTHORITY.ID,
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT,
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       RTRIM(MKPAGE.PAGE_ID) AS USE_CASE_ID,
		       null AS FULL_BO_NAME,
		       null AS BUTTON_NAME,
		       null AS MASK_CLASS,
		       null AS TABLE_ID,
		       null AS CLASS_NAME,
		       null AS METHOD_SIGNATURE,
		       null AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL,
		       AUTHORITY AUTHORITY,
		       MKPAGE MKPAGE
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY
		   AND AUTHORITY.RESOURCE_KEY = MKPAGE.PAGE_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'U'
		   AND USAPPL.APPL_ID = #{value}

		UNION ALL

		/* Fields */
		SELECT AUTHORITY.ID,
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT,
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       RTRIM(MKPAGE.PAGE_ID) AS USE_CASE_ID,
		       RTRIM(MKFIELD.FULL_BO_NAME) AS FULL_BO_NAME,
		       null AS BUTTON_NAME,
		       null AS MASK_CLASS,
		       null AS TABLE_ID,
		       null AS CLASS_NAME,
		       null AS METHOD_SIGNATURE,
		       null AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL,
		       AUTHORITY AUTHORITY,
		       MKPAGE MKPAGE,
		       MKFIELD MKFIELD
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY
		   AND AUTHORITY.RESOURCE_KEY = MKFIELD.FIELD_KEY
		   AND MKFIELD.PAGE_KEY = MKPAGE.PAGE_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'F'
		   AND USAPPL.APPL_ID = #{value}
		   AND AUTHORITY.ID IN (SELECT AUTHORITY.ID
								  FROM AUTHORITY AUTHORITY, 
									   ACL_OBJECT_IDENTITY ACL_OBJECT_IDENTITY,
									   ACL_ENTRY ACL_ENTRY 
								 WHERE AUTHORITY.ID = ACL_OBJECT_IDENTITY.OBJECT_ID_IDENTITY
								   AND ACL_OBJECT_IDENTITY.ID = ACL_ENTRY.ACL_OBJECT_IDENTITY
								   AND AUTHORITY.RESOURCE_TYPE = 'F')
		UNION ALL

		/* Buttons */
		SELECT AUTHORITY.ID, 
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT, 
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       RTRIM(MKPAGE.PAGE_ID) AS USE_CASE_ID,
		       null AS FULL_BO_NAME,
		       RTRIM(BUTTON.BUTTON_NAME) AS BUTTON_NAME,
		       null AS MASK_CLASS,
		       null AS TABLE_ID,
		       null AS CLASS_NAME,
		       null AS METHOD_SIGNATURE,
		       null AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL, 
		       AUTHORITY AUTHORITY, 
		       MKPAGE MKPAGE,
		       BUTTON BUTTON 
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY 
		   AND AUTHORITY.RESOURCE_KEY = BUTTON.BUTTON_KEY 
		   AND BUTTON.PAGE_KEY = MKPAGE.PAGE_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'B'
		   AND USAPPL.APPL_ID = #{value}
		   AND AUTHORITY.ID IN (SELECT AUTHORITY.ID
								  FROM AUTHORITY AUTHORITY, 
									   ACL_OBJECT_IDENTITY ACL_OBJECT_IDENTITY,
									   ACL_ENTRY ACL_ENTRY 
								 WHERE AUTHORITY.ID = ACL_OBJECT_IDENTITY.OBJECT_ID_IDENTITY
								   AND ACL_OBJECT_IDENTITY.ID = ACL_ENTRY.ACL_OBJECT_IDENTITY
								   AND AUTHORITY.RESOURCE_TYPE = 'B')
		UNION ALL

		/* Masking */
		SELECT AUTHORITY.ID,
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT,
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       null AS USE_CASE_ID,
		       null AS FULL_BO_NAME,
		       null AS BUTTON_NAME,
		       RTRIM(MKCLASS.MASK_CLASS) AS MASK_CLASS,
		       null AS TABLE_ID,
		       null AS CLASS_NAME,
		       null AS METHOD_SIGNATURE,
		       null AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL,
		       AUTHORITY AUTHORITY,
		       MKCLASS MKCLASS
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY
		   AND USAPPL.APPL_KEY = MKCLASS.APPL_KEY
		   AND AUTHORITY.RESOURCE_KEY = MKCLASS.MASK_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'M'
		   AND USAPPL.APPL_ID = #{value}

		UNION ALL

		/* Business Rules */
		SELECT AUTHORITY.ID,
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT,
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       null AS USE_CASE_ID,
		       null AS FULL_BO_NAME,
		       null AS BUTTON_NAME,
		       null AS MASK_CLASS,
		       RTRIM(BUSINESS_RULE.TABLE_ID) AS TABLE_ID,
		       null AS CLASS_NAME,
		       null AS METHOD_SIGNATURE,
		       null AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL,
		       AUTHORITY AUTHORITY,
		       BUSINESS_RULE BUSINESS_RULE
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY
		   AND AUTHORITY.RESOURCE_KEY=BUSINESS_RULE.BUSINESS_RULE_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'R'
		   AND USAPPL.APPL_ID = #{value}

		UNION ALL

		/* Service Methods */
		SELECT AUTHORITY.ID,
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT,
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       null AS USE_CASE_ID,
		       null AS FULL_BO_NAME,
		       null AS BUTTON_NAME,
		       null AS MASK_CLASS,
		       null AS TABLE_ID,
		       RTRIM(SERVICE.CLASS_NAME) AS CLASS_NAME,
		       RTRIM(SERVICE_METHOD.METHOD_SIGNATURE) AS METHOD_SIGNATURE,
		       null AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL,
		       AUTHORITY AUTHORITY,
		       SERVICE SERVICE,
		       SERVICE_METHOD SERVICE_METHOD
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY
		   AND AUTHORITY.RESOURCE_KEY = SERVICE_METHOD.SERVICE_METHOD_KEY
		   AND SERVICE_METHOD.SERVICE_KEY = SERVICE.SERVICE_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'S'
		   AND USAPPL.APPL_ID = #{value}

		UNION ALL

		/* Special Operations */
		SELECT AUTHORITY.ID,
		       RTRIM(AUTHORITY.RESOURCE_TYPE) AS RESOURCE_TYPE,
		       RTRIM(AUTHORITY.ENVIRONMENT) AS ENVIRONMENT,
		       RTRIM(AUTHORITY.COMPANY_CODE) AS COMPANY_CODE,
		       null AS USE_CASE_ID,
		       null AS FULL_BO_NAME,
		       null AS BUTTON_NAME,
		       null AS MASK_CLASS,
		       null AS TABLE_ID,
		       null AS CLASS_NAME,
		       null AS METHOD_SIGNATURE,
		       RTRIM(SPECIAL_OPERATION_TYPE) AS SPECIAL_OPERATION_TYPE
		  FROM USAPPL USAPPL,
		       AUTHORITY AUTHORITY,
		       SPECIAL_OPERATION SPECIAL_OPERATION
		 WHERE USAPPL.APPL_KEY = AUTHORITY.APPL_KEY
		   AND AUTHORITY.RESOURCE_KEY = SPECIAL_OPERATION.SPECIAL_OPERATION_KEY
		   AND AUTHORITY.RESOURCE_TYPE = 'O'
		   AND USAPPL.APPL_ID = #{value}
	</select>
</mapper>
